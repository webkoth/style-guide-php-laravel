#develop/tree 

В последнем разделе этого модуля давайте обобщим все факты, которые мы узнали. Итак, есть несколько видов автоматических тестов, а также практика подготовки специальных тестовых данных: сиды, моки, стабы.

## Для чего вообще нужны тесты?

Для чего вообще нужны тесты? Основная причина — это повышение качества ПО, снижение рисков при внесении изменений в код, выявление ошибок, проверка бизнес-требований, повышение безопасности… Продолжать можно долго.

## Юнит-тесты

Самый популярный тип тестов, которые пишут программисты. В юнит тестах вы должны сосредоточиться на отдельных единицах кода — юнитах. Юнитом может быть отдельный класс или функция — небольшой фрагмент кода, выполняющий определенную функцию.

Модульные тесты можно использовать для простой и быстрой проверки бизнес-логики в коде. Каждый тест должен проверять один возможный способ выполнения функции. Рекомендуется охватывать в своих тестах как можно больше различных вариантов исполнения (и это относится не только к модульным тестам, но и ко всем видам тестов). Юнит тесту не нужно, чтобы работал всё приложение работало полностью — вам не нужно подключение к базе данных или что-то еще во время их запуска.

## Из чего состоит каждый тест

Содержимое каждого теста можно разбить на три части: «Дано», «Когда» и «Тогда». Модульные тесты даже имеют для этого собственное имя шаблона, которое называется AAA (Arrange-Act-Assert).

## Первая часть — подготовка данных для теста.

В разделе «Act» заполняется фактический вызов тестируемого метода.
И наконец выполняются ассерты, чтобы проверить, нужный ли результат возвращает тестируемый код.
Благодаря такому подходу тесты выглядят гораздо более читабельными и понятными. Благодаря этому вы с первого взгляда видите, что здесь тестируется. Очень рекомендуется писать модульные тесты в таком стиле.

## Test doubles

Если вы не хотите проверять каждую зависимость в тестах, вы можете использовать Test Doubles, их также можно называть «моками». Это термин для любого имитируемого объекта, используемого вместо реального объекта в целях тестирования. Они могут контролировать поток выполнения кода.

## Интеграционные тесты

Интеграционные тесты — отличное дополнение к модульным тестам. Интеграционные тесты больше ориентированы на связи между модулями и находятся на более высоком уровне, чем модульные тесты. Они проверяют интеграцию между компонентами приложения (например, модулями, классами, службами) и могут зависеть от некоторых конфигураций, таких как параметры подключения к базе данных. Они не такие быстрые, как модульные тесты, но могут делать больше — тестировать запросы к базе данных, интеграцию с некоторыми другими сервисами и т. д.

## Приёмочные тесты

Их задача немного отличается от ранее упомянутых тестов. Основная роль приемочных тестов состоит в том, чтобы определить, выполняются ли требования приложения. Существует несколько типов таких тестов, в том числе пользовательское приемочное тестирование, когда конечные пользователи проверяют приложение. Для приёмочных тестов существуют даже специальные BDD-фреймворки.

Behavior-Driven Development (BDD) — это практика разработки, ориентированная на написание тестов и документации на естественном языке. Этот язык — Gherkin, созданный специально для описания поведения. Это помогает определить функциональные возможности с клиентом. В идеале, такие тесты должны быть написаны во время сбора требований.

## Статический анализ кода

Хотя статический анализ кода это не тест, но он может помочь в процессе проверки вашего приложения. Статический анализ кода — это анализ исходного кода без его запуска. Это позволяет предсказать поведение кода до его выполнения. Существует множество типов анализаторов кода для PHP, наиболее популярными из которых являются PHPStan, EasyCodingStandard, PHP Mess Detector.

## Тестирование производительности

Бывает, что приложение должно принимать много одновременных запросов или обрабатывать несколько тысяч запросов в секунду. Как проверить, соответствует ли приложение всем этим требованиям? Тесты производительности могут с этим помочь.

Было бы проблемой проверить это без соответствующих инструментов. Одним из лучших инструментов для такой работы является k6. Он позволяет вам написать простой скрипт на JavaScript для создания виртуальных пользователей, которые выполняютHTTP-запросы.

## Сколько тестов необходимо вашему приложению?

Как видите, существует множество способов протестировать PHP-приложения. Но сколько и каких тестов необходимо добавить для качественной проверки? На этот вопрос нет простого ответа. Существует тестовый класс, базовый тест, тестовая команда или тестовый метод, а также целые подходы или фреймворки, такие как разработка через тестирование, фреймворк тестирования, ориентированный на программиста, такой как Behat, или различные фреймворки модульного тестирования.

В любом случае, следует знать, что основой для любого автоматизированного тестирования всегда являются юнит-тесты. Они же самый быстрый вид тестов. Более медленные, но вместе с этим и более интегрированные и комплексные тесты — это приёмочные и интеграционные.

Каждый вид теста фокусируется на разных вещах, поскольку у каждого проекта своя специфика. Я рекомендую комбинировать их все автоматически с помощью процесса непрерывной интеграции. Это процесс, который включает в себя автоматическое выполнение всех тестов и других необходимых действий при развертывании вашего приложения на сервере.

prev:[[Функциональные тесты]] next:[[Фоновые задачи и оптимизация]]
