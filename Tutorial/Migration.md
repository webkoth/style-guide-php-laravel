#develop/tree 

Как и любой другой современный PHP-фреймворк Laravel имеет поддержку управления миграциями БД. Реализация миграций не сильно отличается от того же Yii 2, поэтому из этой главы вы узнаете об основных отличиях и особенностях.

## Генерация миграций

Создать файл-заготовку миграции можно как отдельно от модели, так и совместно. Если вы начинаете работать с проектом из состояния «чистого листа», то будет удобно одновременно создать заготовки как для модели, так и для её таблицы.
Выполните команду:

```shell
php artisan make:model ModelName -cfm --api
```
Результатом выполнения будет целый комплект файлов:

- файл миграции
- класс новой модели
- фабрика и сидер (об этом позже)
- класс api контроллера с авто подстановкой моделей в необходимые методы

В новой миграции уже будет прописано создание новой таблицы с базовыми полями: первичный ключ и таймштампы.
Все созданные миграции сохраняются в папке database/migrations

## Синтаксис миграций

Все операции по созданию таблиц, полей и т. п. происходят в классе миграции, внутри метода up (). Далее синтаксис уже отличается: добавление полей для новых или существующих таблиц происходит внутри анонимной функции, которая вызывается в контексте создания или редактирования таблицы.

Например, так выглядит создание новой таблицы и добавление новых полей:

```php
Schema::create('shows', function (Blueprint $table) {
    $table->id();
    $table->string('title');
    $table->string('title_original');
    $table->text('description')->nullable();
    $table->integer('year');
    $table->string('status');
    $table->string('imdbId')->nullable();
    $table->timestampsTz();
});
```

Главным классом, с которым нужно познакомиться для использования миграций, является Illuminate\Database\Schema\Blueprint, ведь именно в нём описаны все методы для описания полей (вне зависимости для новой или существующей таблицы).
Доступные методы и их сигнатуры подробно описаны в официальной документации, поэтому нет смысла дублировать это всё здесь.

## Внешние ключи и ограничения полей

В заключение разберемся как добавлять полям индексы и организовывать связи. Начнём с индексов.

## Индексы

Описав набор полей, как в примере выше, вы можете добавить нужным полям индексы. Например, для указания первичного ключа или задания уникальности. Индексы задаются в контексте таблицы. В примере ниже добавляются два индекса:

первичный ключ для поля id
индекс уникальности для поля imdbid
```php
Schema::create('shows', function (Blueprint $table) {
    $table->primary('id');
    $table->unique('imdbId');
});
```

## Внешние ключи

Напомним, что внешние ключи позволяют базе данных контролировать целостность данных. Внешние ключи также облегчают работу автогенерации кода в вопросе автоматического добавления связей между моделями. Если вы уже создали модели и описали в них связи, то добавить в таблице ограничения внешнего ключа будет особенно просто. Используйте такую запись:

```php
Schema::create('shows', function (Blueprint $table) {
    $table->foreignIdFor(Show::class)->constrained();
});
```
это будет равнозначно последовательному вызову методов:

```php
Schema::create('shows', function (Blueprint $table) {
    $table->foreign('show_id')->references('id')->on('shows')->index();
});
```

prev:[[QueryBuilder]] next:[[Сиды]]
